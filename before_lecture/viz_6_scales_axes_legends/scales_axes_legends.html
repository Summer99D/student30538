<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Peter Ganong and Maggie Shi">
<meta name="dcterms.date" content="2024-10-19">

<title>Visualization (Scales and Guides)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="scales_axes_legends_files/libs/clipboard/clipboard.min.js"></script>
<script src="scales_axes_legends_files/libs/quarto-html/quarto.js"></script>
<script src="scales_axes_legends_files/libs/quarto-html/popper.min.js"></script>
<script src="scales_axes_legends_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="scales_axes_legends_files/libs/quarto-html/anchor.min.js"></script>
<link href="scales_axes_legends_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="scales_axes_legends_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="scales_axes_legends_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="scales_axes_legends_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="scales_axes_legends_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#intro" id="toc-intro" class="nav-link active" data-scroll-target="#intro">Intro</a>
  <ul class="collapse">
  <li><a href="#roadmap" id="toc-roadmap" class="nav-link" data-scroll-target="#roadmap">roadmap</a></li>
  <li><a href="#scales-and-guides" id="toc-scales-and-guides" class="nav-link" data-scroll-target="#scales-and-guides">scales and guides</a></li>
  <li><a href="#dataset-for-this-lecture-antibiotics" id="toc-dataset-for-this-lecture-antibiotics" class="nav-link" data-scroll-target="#dataset-for-this-lecture-antibiotics">Dataset for this lecture: <code>antibiotics</code></a></li>
  <li><a href="#our-research-questions" id="toc-our-research-questions" class="nav-link" data-scroll-target="#our-research-questions">Our research questions</a></li>
  </ul></li>
  <li><a href="#configuring-scales-and-axes" id="toc-configuring-scales-and-axes" class="nav-link" data-scroll-target="#configuring-scales-and-axes">Configuring Scales and Axes</a>
  <ul class="collapse">
  <li><a href="#configuring-scales-and-axes-roadmap" id="toc-configuring-scales-and-axes-roadmap" class="nav-link" data-scroll-target="#configuring-scales-and-axes-roadmap">Configuring Scales and Axes: roadmap</a></li>
  <li><a href="#plotting-antibiotic-resistance-adjusting-the-scale-type" id="toc-plotting-antibiotic-resistance-adjusting-the-scale-type" class="nav-link" data-scroll-target="#plotting-antibiotic-resistance-adjusting-the-scale-type">Plotting Antibiotic Resistance: Adjusting the Scale Type</a></li>
  <li><a href="#alt-scale-i" id="toc-alt-scale-i" class="nav-link" data-scroll-target="#alt-scale-i">alt scale I</a></li>
  <li><a href="#alt-scale-ii" id="toc-alt-scale-ii" class="nav-link" data-scroll-target="#alt-scale-ii">alt scale II</a></li>
  <li><a href="#styling-an-axis" id="toc-styling-an-axis" class="nav-link" data-scroll-target="#styling-an-axis">Styling an Axis</a></li>
  <li><a href="#add-a-clarifying-title" id="toc-add-a-clarifying-title" class="nav-link" data-scroll-target="#add-a-clarifying-title">add a clarifying title</a></li>
  <li><a href="#comparing-antibiotics-adjusting-grid-lines-tick-counts-and-sizing" id="toc-comparing-antibiotics-adjusting-grid-lines-tick-counts-and-sizing" class="nav-link" data-scroll-target="#comparing-antibiotics-adjusting-grid-lines-tick-counts-and-sizing">Comparing Antibiotics: Adjusting Grid Lines, Tick Counts, and Sizing</a></li>
  <li><a href="#fix-domain-equalize-aspect-ratio" id="toc-fix-domain-equalize-aspect-ratio" class="nav-link" data-scroll-target="#fix-domain-equalize-aspect-ratio">fix <code>domain</code>, equalize aspect ratio</a></li>
  <li><a href="#reduce-grid-clutter-with-alt.axistickcount5" id="toc-reduce-grid-clutter-with-alt.axistickcount5" class="nav-link" data-scroll-target="#reduce-grid-clutter-with-alt.axistickcount5">reduce grid clutter with <code>alt.Axis(tickCount=5)</code></a></li>
  <li><a href="#configuring-scales-and-axes-summary" id="toc-configuring-scales-and-axes-summary" class="nav-link" data-scroll-target="#configuring-scales-and-axes-summary">Configuring Scales and Axes: summary</a></li>
  </ul></li>
  <li><a href="#configuring-color-legends" id="toc-configuring-color-legends" class="nav-link" data-scroll-target="#configuring-color-legends">Configuring Color Legends</a>
  <ul class="collapse">
  <li><a href="#configuring-color-legends-roadmap-and-warning" id="toc-configuring-color-legends-roadmap-and-warning" class="nav-link" data-scroll-target="#configuring-color-legends-roadmap-and-warning">Configuring Color Legends: roadmap and warning</a></li>
  <li><a href="#visualization-as-a-tool-for-discovery" id="toc-visualization-as-a-tool-for-discovery" class="nav-link" data-scroll-target="#visualization-as-a-tool-for-discovery">Visualization as a tool for discovery</a></li>
  <li><a href="#gram-staining" id="toc-gram-staining" class="nav-link" data-scroll-target="#gram-staining">Gram staining</a></li>
  <li><a href="#alt.colorgram_stainingn" id="toc-alt.colorgram_stainingn" class="nav-link" data-scroll-target="#alt.colorgram_stainingn">alt.Color(‘Gram_Staining:N’)</a></li>
  <li><a href="#sometimes-helpful-trick-choose-colors-with-external-meaning" id="toc-sometimes-helpful-trick-choose-colors-with-external-meaning" class="nav-link" data-scroll-target="#sometimes-helpful-trick-choose-colors-with-external-meaning">Sometimes helpful trick: choose colors with external meaning</a></li>
  <li><a href="#color-by-species-i" id="toc-color-by-species-i" class="nav-link" data-scroll-target="#color-by-species-i">Color by Species I</a></li>
  <li><a href="#color-by-species-ii" id="toc-color-by-species-ii" class="nav-link" data-scroll-target="#color-by-species-ii">Color by Species II</a></li>
  <li><a href="#color-by-species-iii-color-as-o" id="toc-color-by-species-iii-color-as-o" class="nav-link" data-scroll-target="#color-by-species-iii-color-as-o">Color by Species III – color as <code>O</code></a></li>
  <li><a href="#color-by-species-iv-use-viridis" id="toc-color-by-species-iv-use-viridis" class="nav-link" data-scroll-target="#color-by-species-iv-use-viridis">Color by Species IV – use <code>viridis</code></a></li>
  <li><a href="#discussion-questions" id="toc-discussion-questions" class="nav-link" data-scroll-target="#discussion-questions">Discussion questions</a></li>
  <li><a href="#text-labels-by-species" id="toc-text-labels-by-species" class="nav-link" data-scroll-target="#text-labels-by-species">Text Labels by Species</a></li>
  <li><a href="#color-by-genus-i" id="toc-color-by-genus-i" class="nav-link" data-scroll-target="#color-by-genus-i">Color by Genus I</a></li>
  <li><a href="#color-by-genus-ii" id="toc-color-by-genus-ii" class="nav-link" data-scroll-target="#color-by-genus-ii">Color by Genus II</a></li>
  <li><a href="#color-by-antibiotic-response-i" id="toc-color-by-antibiotic-response-i" class="nav-link" data-scroll-target="#color-by-antibiotic-response-i">Color by Antibiotic Response I</a></li>
  <li><a href="#color-by-antibiotic-response-ii" id="toc-color-by-antibiotic-response-ii" class="nav-link" data-scroll-target="#color-by-antibiotic-response-ii">Color by Antibiotic Response II</a></li>
  <li><a href="#configuring-color-legends-summary" id="toc-configuring-color-legends-summary" class="nav-link" data-scroll-target="#configuring-color-legends-summary">Configuring Color Legends: summary</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Visualization (Scales and Guides)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Peter Ganong and Maggie Shi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 19, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<!--
    beamer:
        echo: true
        eval: true
        aspectratio: 169
        theme: default
        toc: true
        header-includes: \renewcommand{\tightlist}{\setlength{\itemsep}{5ex}\setlength{\parskip}{0pt}}
            \setbeamertemplate{footline}[frame number] 
            -->
<section id="intro" class="level1">
<h1>Intro</h1>
<section id="roadmap" class="level2">
<h2 class="anchored" data-anchor-id="roadmap">roadmap</h2>
<ul>
<li>define scales and guides</li>
<li>load and explain dataset</li>
</ul>
<p>(no summary at end because slides are self-contained)</p>
</section>
<section id="scales-and-guides" class="level2">
<h2 class="anchored" data-anchor-id="scales-and-guides">scales and guides</h2>
<p>“Visual encoding mapping data to visual variables such as position, size, shape, or color is the beating heart of data visualization.”</p>
<p>Two steps:</p>
<ol type="1">
<li><em>scale</em>: a function that takes a data value as input (the scale <em>domain</em>) and returns a visual value, such as a pixel position or RGB color, as output (the scale <em>range</em>).</li>
<li><em>guide</em>: that allow readers to decode the graphic. Two types:
<ul>
<li><em>axes</em> which visualize scales with spatial ranges</li>
<li><em>legends</em> which visualize scales with color, size, or shape ranges</li>
</ul></li>
</ol>
</section>
<section id="dataset-for-this-lecture-antibiotics" class="level2">
<h2 class="anchored" data-anchor-id="dataset-for-this-lecture-antibiotics">Dataset for this lecture: <code>antibiotics</code></h2>
<ul>
<li>Each row: a type of bacteria</li>
<li>Each column: a type of antibiotic</li>
<li>Each value: <em>minimum inhibitory concentration (MIC)</em> the concentration of antibiotic (in micrograms per milliliter) required to prevent growth in vitro. Lower values means antibiotic is <em>more effective</em></li>
<li>There are two other columns with the genus of the bacteria and the response to a lab procedure called “gram staining”. We will come back to these later.</li>
<li>“In the fall of 1951, Will Burtin published this graph showing the effectiveness of three popular antibiotics on 16 different bacteria, measured in terms of minimum inhibitory concentration.” <a href="http://borgar.net/s/2016/03/will-burtins-antibiotics/">source</a></li>
</ul>
<p><img src="pictures/burtin.png" class="img-fluid"></p>
<p>Discussion questions</p>
<ul>
<li>headline? (aka the main message)</li>
<li>sub-messages? (other information one can learn beyond the main message)</li>
</ul>
</section>
<section id="our-research-questions" class="level2">
<h2 class="anchored" data-anchor-id="our-research-questions">Our research questions</h2>
<p>We will dive deeper into his data with the following research questions:</p>
<ol type="1">
<li>How effective is neomycin against different types of bacteria?</li>
<li>How does neomycin compare to other antibiotics, such as streptomycin and penicillin?</li>
<li>For which types of bacteria are neomycin and penicillin effective?</li>
</ol>
<div id="1fe97873" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="311022ab" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>antibiotics <span class="op">=</span> <span class="st">'https://cdn.jsdelivr.net/npm/vega-datasets@1/data/burtin.json'</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pd.read_json(antibiotics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f1283d36" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>antibiotics[[<span class="st">'Bacteria'</span>, <span class="st">'Penicillin'</span>, <span class="st">'Streptomycin'</span>, <span class="st">'Neomycin'</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Bacteria</th>
<th data-quarto-table-cell-role="th">Penicillin</th>
<th data-quarto-table-cell-role="th">Streptomycin</th>
<th data-quarto-table-cell-role="th">Neomycin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Aerobacter aerogenes</td>
<td>870.000</td>
<td>1.00</td>
<td>1.600</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Bacillus anthracis</td>
<td>0.001</td>
<td>0.01</td>
<td>0.007</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Brucella abortus</td>
<td>1.000</td>
<td>2.00</td>
<td>0.020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Diplococcus pneumoniae</td>
<td>0.005</td>
<td>11.00</td>
<td>10.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Escherichia coli</td>
<td>100.000</td>
<td>0.40</td>
<td>0.100</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Discussion questions:</p>
<ul>
<li>are these data “tidy”?</li>
<li>if no, how would you tidy them?</li>
</ul>
</section>
</section>
<section id="configuring-scales-and-axes" class="level1">
<h1>Configuring Scales and Axes</h1>
<section id="configuring-scales-and-axes-roadmap" class="level2">
<h2 class="anchored" data-anchor-id="configuring-scales-and-axes-roadmap">Configuring Scales and Axes: roadmap</h2>
<ul>
<li>manipulate <code>alt.Scale()</code></li>
<li>clarify the meaning implied by an axis</li>
<li>change the length (<code>domain</code>) of an axis</li>
<li>change grid lines via <code>alt.Axis()</code></li>
</ul>
</section>
<section id="plotting-antibiotic-resistance-adjusting-the-scale-type" class="level2">
<h2 class="anchored" data-anchor-id="plotting-antibiotic-resistance-adjusting-the-scale-type">Plotting Antibiotic Resistance: Adjusting the Scale Type</h2>
<p>Default scale is linear</p>
<div id="06eb6cba" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_circle().encode(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Neomycin:Q'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="4">

<style>
  #altair-viz-d37bb593899b4b0aa4c7f25b6c6e7d30.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-d37bb593899b4b0aa4c7f25b6c6e7d30.vega-embed details,
  #altair-viz-d37bb593899b4b0aa4c7f25b6c6e7d30.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-d37bb593899b4b0aa4c7f25b6c6e7d30"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-d37bb593899b4b0aa4c7f25b6c6e7d30") {
      outputDiv = document.getElementById("altair-viz-d37bb593899b4b0aa4c7f25b6c6e7d30");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "circle"}, "encoding": {"x": {"field": "Neomycin", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<p>Discussion question: why is this plot hard to read?</p>
</section>
<section id="alt-scale-i" class="level2">
<h2 class="anchored" data-anchor-id="alt-scale-i">alt scale I</h2>
<div id="1e1c34d9" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_circle().encode(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Neomycin:Q'</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'sqrt'</span>))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="5">

<style>
  #altair-viz-5282345e98ac4c8699812ded96c065fd.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-5282345e98ac4c8699812ded96c065fd.vega-embed details,
  #altair-viz-5282345e98ac4c8699812ded96c065fd.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-5282345e98ac4c8699812ded96c065fd"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-5282345e98ac4c8699812ded96c065fd") {
      outputDiv = document.getElementById("altair-viz-5282345e98ac4c8699812ded96c065fd");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "circle"}, "encoding": {"x": {"field": "Neomycin", "scale": {"type": "sqrt"}, "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="alt-scale-ii" class="level2">
<h2 class="anchored" data-anchor-id="alt-scale-ii">alt scale II</h2>
<div id="f196694b" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_circle().encode(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Neomycin:Q'</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">

<style>
  #altair-viz-9115a763e1a7465abfe44ffa2d6affde.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-9115a763e1a7465abfe44ffa2d6affde.vega-embed details,
  #altair-viz-9115a763e1a7465abfe44ffa2d6affde.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-9115a763e1a7465abfe44ffa2d6affde"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-9115a763e1a7465abfe44ffa2d6affde") {
      outputDiv = document.getElementById("altair-viz-9115a763e1a7465abfe44ffa2d6affde");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "circle"}, "encoding": {"x": {"field": "Neomycin", "scale": {"type": "log"}, "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<p>Discussion question: what does this plot do well? What is confusing about it?</p>
</section>
<section id="styling-an-axis" class="level2">
<h2 class="anchored" data-anchor-id="styling-an-axis">Styling an Axis</h2>
<ul>
<li>Lower dosages indicate higher effectiveness. However, many readers will expect values that are “better” to be “up and to the right” within a chart.</li>
<li>If we want to cater to this convention set the encoding <code>sort</code> property to <code>'descending'</code>:</li>
</ul>
<div id="55d962ef" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_circle().encode(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Neomycin:Q'</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="7">

<style>
  #altair-viz-0988db3084fe47b391822eefec5b1e97.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-0988db3084fe47b391822eefec5b1e97.vega-embed details,
  #altair-viz-0988db3084fe47b391822eefec5b1e97.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-0988db3084fe47b391822eefec5b1e97"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-0988db3084fe47b391822eefec5b1e97") {
      outputDiv = document.getElementById("altair-viz-0988db3084fe47b391822eefec5b1e97");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "circle"}, "encoding": {"x": {"field": "Neomycin", "scale": {"type": "log"}, "sort": "descending", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="add-a-clarifying-title" class="level2">
<h2 class="anchored" data-anchor-id="add-a-clarifying-title">add a clarifying title</h2>
<div id="9021d30b" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_circle().encode(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Neomycin:Q'</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Neomycin MIC (μg/ml) --- more effective →'</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="8">

<style>
  #altair-viz-d2ce148571484499aa7a97547c640c8c.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-d2ce148571484499aa7a97547c640c8c.vega-embed details,
  #altair-viz-d2ce148571484499aa7a97547c640c8c.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-d2ce148571484499aa7a97547c640c8c"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-d2ce148571484499aa7a97547c640c8c") {
      outputDiv = document.getElementById("altair-viz-d2ce148571484499aa7a97547c640c8c");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "circle"}, "encoding": {"x": {"field": "Neomycin", "scale": {"type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Neomycin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<p>Editorial remark: the textbook suggests a title of “Neomycin MIC (μg/ml, reverse log scale)”. This is accurate, but I don’t know it helps the reader that much.</p>
<ol type="1">
<li>The fact that it is a log scale is self-evident. So is the fact that it is reversed.</li>
<li>What the reader really wants to know is which direction is “good”. Just tell them that directly.</li>
</ol>
</section>
<section id="comparing-antibiotics-adjusting-grid-lines-tick-counts-and-sizing" class="level2">
<h2 class="anchored" data-anchor-id="comparing-antibiotics-adjusting-grid-lines-tick-counts-and-sizing">Comparing Antibiotics: Adjusting Grid Lines, Tick Counts, and Sizing</h2>
<p><em>How does neomycin compare to streptomycin?</em></p>
<p>Question for the class: what does each point repesent?</p>
<div id="d13cdf9c" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_circle().encode(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Neomycin:Q'</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Neomycin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'Streptomycin:Q'</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>),</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Streptomycin MIC (μg/ml) --- more effective →'</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">

<style>
  #altair-viz-1ae644b5d9844c68856b3ea3702a4270.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-1ae644b5d9844c68856b3ea3702a4270.vega-embed details,
  #altair-viz-1ae644b5d9844c68856b3ea3702a4270.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-1ae644b5d9844c68856b3ea3702a4270"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-1ae644b5d9844c68856b3ea3702a4270") {
      outputDiv = document.getElementById("altair-viz-1ae644b5d9844c68856b3ea3702a4270");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "circle"}, "encoding": {"x": {"field": "Neomycin", "scale": {"type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Neomycin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}, "y": {"field": "Streptomycin", "scale": {"type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Streptomycin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<p>This plot shows that bacteria responds similarly to these two antibiotics – it approximately follows the 45-degree line.</p>
<p><em>How does neomycin compare to penicillin?</em></p>
<div id="64ca184e" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_circle().encode(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Neomycin:Q'</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Neomycin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'Penicillin:Q'</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Penicillin MIC (μg/ml) --- more effective →'</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">

<style>
  #altair-viz-5668603327b44167b824b43b0ba71b84.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-5668603327b44167b824b43b0ba71b84.vega-embed details,
  #altair-viz-5668603327b44167b824b43b0ba71b84.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-5668603327b44167b824b43b0ba71b84"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-5668603327b44167b824b43b0ba71b84") {
      outputDiv = document.getElementById("altair-viz-5668603327b44167b824b43b0ba71b84");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "circle"}, "encoding": {"x": {"field": "Neomycin", "scale": {"type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Neomycin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}, "y": {"field": "Penicillin", "scale": {"type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Penicillin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<p><em>Now we see a more differentiated response: some bacteria respond well to neomycin but not penicillin, and vice versa!</em></p>
</section>
<section id="fix-domain-equalize-aspect-ratio" class="level2">
<h2 class="anchored" data-anchor-id="fix-domain-equalize-aspect-ratio">fix <code>domain</code>, equalize aspect ratio</h2>
<p>While this plot is useful, we can make it better. The x and y axes use the same units, but have different extents (the chart width is larger than the height) and different domains (0.001 to 100 for the x-axis, and 0.001 to 1,000 for the y-axis).</p>
<div id="8541a898" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_circle().encode(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Neomycin:Q'</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Neomycin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'Penicillin:Q'</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Penicillin MIC (μg/ml) --- more effective →'</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>).properties(width<span class="op">=</span><span class="dv">250</span>, height<span class="op">=</span><span class="dv">250</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">

<style>
  #altair-viz-5ac07a7c1c5247ceb3eff5e46f15827c.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-5ac07a7c1c5247ceb3eff5e46f15827c.vega-embed details,
  #altair-viz-5ac07a7c1c5247ceb3eff5e46f15827c.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-5ac07a7c1c5247ceb3eff5e46f15827c"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-5ac07a7c1c5247ceb3eff5e46f15827c") {
      outputDiv = document.getElementById("altair-viz-5ac07a7c1c5247ceb3eff5e46f15827c");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "circle"}, "encoding": {"x": {"field": "Neomycin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Neomycin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}, "y": {"field": "Penicillin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Penicillin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}}, "height": 250, "width": 250, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="reduce-grid-clutter-with-alt.axistickcount5" class="level2">
<h2 class="anchored" data-anchor-id="reduce-grid-clutter-with-alt.axistickcount5">reduce grid clutter with <code>alt.Axis(tickCount=5)</code></h2>
<p>Also set <code>mark_circle(size=80)</code></p>
<div id="daacdfb2" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_circle(size<span class="op">=</span><span class="dv">80</span>).encode(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Neomycin:Q'</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Neomycin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'Penicillin:Q'</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Penicillin MIC (μg/ml) --- more effective →'</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>).properties(width<span class="op">=</span><span class="dv">250</span>, height<span class="op">=</span><span class="dv">250</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="12">

<style>
  #altair-viz-1045fd53a15e42e2af7a3f4b71941301.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-1045fd53a15e42e2af7a3f4b71941301.vega-embed details,
  #altair-viz-1045fd53a15e42e2af7a3f4b71941301.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-1045fd53a15e42e2af7a3f4b71941301"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-1045fd53a15e42e2af7a3f4b71941301") {
      outputDiv = document.getElementById("altair-viz-1045fd53a15e42e2af7a3f4b71941301");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "circle", "size": 80}, "encoding": {"x": {"axis": {"tickCount": 5}, "field": "Neomycin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Neomycin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}, "y": {"axis": {"tickCount": 5}, "field": "Penicillin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Penicillin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}}, "height": 250, "width": 250, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<p>Discussion questions: 1) What questions does this plot answer? 2) What further questions does this plot raise?</p>
</section>
<section id="configuring-scales-and-axes-summary" class="level2">
<h2 class="anchored" data-anchor-id="configuring-scales-and-axes-summary">Configuring Scales and Axes: summary</h2>
<p>How to make your axes and grids as informative as possible</p>
<ul>
<li>Choose an <code>alt.Scale()</code> that reveals differences between the data (in most cases…)</li>
<li>Axis titles should clarify meaning</li>
<li>Deliberately choose axis length via <code>domain</code> argument</li>
<li>Reduce grid clutter via <code>alt.Axis()</code></li>
</ul>
</section>
</section>
<section id="configuring-color-legends" class="level1">
<h1>Configuring Color Legends</h1>
<section id="configuring-color-legends-roadmap-and-warning" class="level2">
<h2 class="anchored" data-anchor-id="configuring-color-legends-roadmap-and-warning">Configuring Color Legends: roadmap and warning</h2>
<ul>
<li>Visualization as a tool for discovery</li>
<li><code>alt.Color()</code> in legends
<ul>
<li>binary variable</li>
<li>text data (every dot is different)</li>
<li>groups</li>
</ul></li>
<li>use color to encode quantitative values</li>
</ul>
<p>Remarks:</p>
<ul>
<li>This section of the textbook asks you to practice your “skepticism” muscle. What we mean by that is that it is mostly about showing what does <em>not</em> work. we will follow the textbook, but for many of the plots, your first question should not be “where would I want to use this tool?” but rather “why is this not a good idea?”</li>
<li>The official title of this section of lecture is about color legends, but the deeper lessons are about how to clean data to uncover and communciate structure</li>
</ul>
</section>
<section id="visualization-as-a-tool-for-discovery" class="level2">
<h2 class="anchored" data-anchor-id="visualization-as-a-tool-for-discovery">Visualization as a tool for discovery</h2>
<ul>
<li>Above we saw that neomycin is more effective for some bacteria, while penicillin is more effective for others.</li>
<li>Is there any systematic answer to what types of bacteria each drug is more effective for? This is the kind of question for which data visualization shines.</li>
<li>If we just stared at a table in Excel or Pandas, it might be hard to see patterns (and at the very least it would take awhile). Until now, almost everything we have seen for data visualization has been about <strong>communication</strong>. Now, we are going to see how data visualization can be a tool for <strong>discovery</strong>.</li>
</ul>
</section>
<section id="gram-staining" class="level2">
<h2 class="anchored" data-anchor-id="gram-staining">Gram staining</h2>
<p>Let’s start by looking at one of the other columns in the data frame (which we have ignored until now).</p>
<p>A tiny bit of science: the reaction of the bacteria to a procedure called <a href="https://en.wikipedia.org/wiki/Gram_stain">Gram staining</a> is described by the nominal field <code>Gram_Staining</code>. Bacteria that turn dark blue or violet are Gram-positive. Otherwise, they are Gram-negative.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/Gram_stain_01.jpg" class="img-fluid figure-img"></p>
<figcaption>Gram staining example</figcaption>
</figure>
</div>
<div id="704b8000" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>antibiotics[[<span class="st">'Gram_Staining'</span>]].tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Gram_Staining</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>positive</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>positive</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>positive</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>positive</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>positive</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="alt.colorgram_stainingn" class="level2">
<h2 class="anchored" data-anchor-id="alt.colorgram_stainingn">alt.Color(‘Gram_Staining:N’)</h2>
<p>Let’s encode <code>Gram_Staining</code> on the <code>color</code> channel as a nominal data type:</p>
<div id="fb2a6d49" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_circle(size<span class="op">=</span><span class="dv">80</span>).encode(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Neomycin:Q'</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Neomycin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'Penicillin:Q'</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Penicillin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    alt.Color(<span class="st">'Gram_Staining:N'</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>).properties(width<span class="op">=</span><span class="dv">250</span>, height<span class="op">=</span><span class="dv">250</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="14">

<style>
  #altair-viz-a3e0b829f80a4c51894f484c454ef9e1.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-a3e0b829f80a4c51894f484c454ef9e1.vega-embed details,
  #altair-viz-a3e0b829f80a4c51894f484c454ef9e1.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-a3e0b829f80a4c51894f484c454ef9e1"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-a3e0b829f80a4c51894f484c454ef9e1") {
      outputDiv = document.getElementById("altair-viz-a3e0b829f80a4c51894f484c454ef9e1");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "circle", "size": 80}, "encoding": {"color": {"field": "Gram_Staining", "type": "nominal"}, "x": {"axis": {"tickCount": 5}, "field": "Neomycin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Neomycin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}, "y": {"axis": {"tickCount": 5}, "field": "Penicillin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Penicillin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}}, "height": 250, "width": 250, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<p>We can see that Gram-positive bacteria seem most susceptible to penicillin, whereas neomycin is more effective for Gram-negative bacteria!</p>
</section>
<section id="sometimes-helpful-trick-choose-colors-with-external-meaning" class="level2">
<h2 class="anchored" data-anchor-id="sometimes-helpful-trick-choose-colors-with-external-meaning">Sometimes helpful trick: choose colors with external meaning</h2>
<p>However, we might wish to customize the colors used. In this case, we might want to use the colors that come out in lab when you do gram staining. Let’s use those colors by specifying an explicit scale mapping from the data <code>domain</code> to the color <code>range</code>:</p>
<div id="bb131b33" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_circle(size<span class="op">=</span><span class="dv">80</span>).encode(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Neomycin:Q'</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Neomycin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'Penicillin:Q'</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Penicillin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    alt.Color(<span class="st">'Gram_Staining:N'</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(domain<span class="op">=</span>[<span class="st">'negative'</span>, <span class="st">'positive'</span>], <span class="bu">range</span><span class="op">=</span>[<span class="st">'hotpink'</span>, <span class="st">'purple'</span>])</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>).properties(width<span class="op">=</span><span class="dv">250</span>, height<span class="op">=</span><span class="dv">250</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">

<style>
  #altair-viz-b2b0f163d8324cd7b52838fa146d3739.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-b2b0f163d8324cd7b52838fa146d3739.vega-embed details,
  #altair-viz-b2b0f163d8324cd7b52838fa146d3739.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-b2b0f163d8324cd7b52838fa146d3739"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-b2b0f163d8324cd7b52838fa146d3739") {
      outputDiv = document.getElementById("altair-viz-b2b0f163d8324cd7b52838fa146d3739");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "circle", "size": 80}, "encoding": {"color": {"field": "Gram_Staining", "scale": {"domain": ["negative", "positive"], "range": ["hotpink", "purple"]}, "type": "nominal"}, "x": {"axis": {"tickCount": 5}, "field": "Neomycin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Neomycin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}, "y": {"axis": {"tickCount": 5}, "field": "Penicillin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Penicillin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}}, "height": 250, "width": 250, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="color-by-species-i" class="level2">
<h2 class="anchored" data-anchor-id="color-by-species-i">Color by Species I</h2>
<div id="f717b2ea" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_circle(size<span class="op">=</span><span class="dv">80</span>).encode(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Neomycin:Q'</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Neomycin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'Penicillin:Q'</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Penicillin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    alt.Color(<span class="st">'Bacteria:N'</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>).properties(width<span class="op">=</span><span class="dv">250</span>, height<span class="op">=</span><span class="dv">250</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">

<style>
  #altair-viz-c7463d896ccf44509532a494088d485f.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-c7463d896ccf44509532a494088d485f.vega-embed details,
  #altair-viz-c7463d896ccf44509532a494088d485f.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-c7463d896ccf44509532a494088d485f"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-c7463d896ccf44509532a494088d485f") {
      outputDiv = document.getElementById("altair-viz-c7463d896ccf44509532a494088d485f");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "circle", "size": 80}, "encoding": {"color": {"field": "Bacteria", "type": "nominal"}, "x": {"axis": {"tickCount": 5}, "field": "Neomycin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Neomycin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}, "y": {"axis": {"tickCount": 5}, "field": "Penicillin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Penicillin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}}, "height": 250, "width": 250, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<p>Discussion question: what’s wrong with this plot?</p>
</section>
<section id="color-by-species-ii" class="level2">
<h2 class="anchored" data-anchor-id="color-by-species-ii">Color by Species II</h2>
<p>Use <code>tableau20</code> so we have 20 colors instead of 10</p>
<div id="8d2be414" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_circle(size<span class="op">=</span><span class="dv">80</span>).encode(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Neomycin:Q'</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Neomycin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'Penicillin:Q'</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Penicillin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    alt.Color(<span class="st">'Bacteria:N'</span>,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(scheme<span class="op">=</span><span class="st">'tableau20'</span>))</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>).properties(width<span class="op">=</span><span class="dv">250</span>, height<span class="op">=</span><span class="dv">250</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="17">

<style>
  #altair-viz-a36296ab2b0d427e8189d74059fbb8f3.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-a36296ab2b0d427e8189d74059fbb8f3.vega-embed details,
  #altair-viz-a36296ab2b0d427e8189d74059fbb8f3.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-a36296ab2b0d427e8189d74059fbb8f3"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-a36296ab2b0d427e8189d74059fbb8f3") {
      outputDiv = document.getElementById("altair-viz-a36296ab2b0d427e8189d74059fbb8f3");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "circle", "size": 80}, "encoding": {"color": {"field": "Bacteria", "scale": {"scheme": "tableau20"}, "type": "nominal"}, "x": {"axis": {"tickCount": 5}, "field": "Neomycin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Neomycin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}, "y": {"axis": {"tickCount": 5}, "field": "Penicillin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Penicillin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}}, "height": 250, "width": 250, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<p>Problem with this plot: bacteria that are similar (all in the “staph” family) have very different colors</p>
</section>
<section id="color-by-species-iii-color-as-o" class="level2">
<h2 class="anchored" data-anchor-id="color-by-species-iii-color-as-o">Color by Species III – color as <code>O</code></h2>
<div id="093fab63" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_circle(size<span class="op">=</span><span class="dv">80</span>).encode(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Neomycin:Q'</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Neomycin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'Penicillin:Q'</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Penicillin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    alt.Color(<span class="st">'Bacteria:O'</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>).properties(width<span class="op">=</span><span class="dv">250</span>, height<span class="op">=</span><span class="dv">250</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">

<style>
  #altair-viz-518f8731ce5647ebbe8cfa813cd05e57.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-518f8731ce5647ebbe8cfa813cd05e57.vega-embed details,
  #altair-viz-518f8731ce5647ebbe8cfa813cd05e57.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-518f8731ce5647ebbe8cfa813cd05e57"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-518f8731ce5647ebbe8cfa813cd05e57") {
      outputDiv = document.getElementById("altair-viz-518f8731ce5647ebbe8cfa813cd05e57");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "circle", "size": 80}, "encoding": {"color": {"field": "Bacteria", "type": "ordinal"}, "x": {"axis": {"tickCount": 5}, "field": "Neomycin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Neomycin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}, "y": {"axis": {"tickCount": 5}, "field": "Penicillin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Penicillin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}}, "height": 250, "width": 250, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<p>Problems with this plot:</p>
<ol type="1">
<li>the blue shades are hard to distinguish from one another.</li>
<li>although it is nice to assign similar colors to bacteria in the same family, this legend also assigns similar colors to bacteria that are not in the same family</li>
</ol>
<p>A partial solution to (1) is to use a different color scheme</p>
</section>
<section id="color-by-species-iv-use-viridis" class="level2">
<h2 class="anchored" data-anchor-id="color-by-species-iv-use-viridis">Color by Species IV – use <code>viridis</code></h2>
<p>This scheme increases both hue and luminance</p>
<div id="65a2dc1d" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_circle(size<span class="op">=</span><span class="dv">80</span>).encode(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Neomycin:Q'</span>,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Neomycin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'Penicillin:Q'</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Penicillin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    alt.Color(<span class="st">'Bacteria:O'</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(scheme<span class="op">=</span><span class="st">'viridis'</span>))</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>).properties(width<span class="op">=</span><span class="dv">250</span>, height<span class="op">=</span><span class="dv">250</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="19">

<style>
  #altair-viz-c88bfd0e529c4fefaaf787c879d05843.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-c88bfd0e529c4fefaaf787c879d05843.vega-embed details,
  #altair-viz-c88bfd0e529c4fefaaf787c879d05843.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-c88bfd0e529c4fefaaf787c879d05843"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-c88bfd0e529c4fefaaf787c879d05843") {
      outputDiv = document.getElementById("altair-viz-c88bfd0e529c4fefaaf787c879d05843");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "circle", "size": 80}, "encoding": {"color": {"field": "Bacteria", "scale": {"scheme": "viridis"}, "type": "ordinal"}, "x": {"axis": {"tickCount": 5}, "field": "Neomycin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Neomycin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}, "y": {"axis": {"tickCount": 5}, "field": "Penicillin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Penicillin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}}, "height": 250, "width": 250, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="discussion-questions" class="level2">
<h2 class="anchored" data-anchor-id="discussion-questions">Discussion questions</h2>
<p>Examples III and IV are jury-rigged to work nicely. They work because</p>
<ul>
<li>legend is ordered alphabetically</li>
<li>bacteria family is at the beginning of the name of each strain.</li>
</ul>
<p>Suppose instead that the family was instead at the <em>end</em> of the name</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>bacteria name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Viridans, streptococcus</td>
</tr>
<tr class="even">
<td>Hemolycticus, Streptococcus</td>
</tr>
</tbody>
</table>
<p>Let’s troubleshoot in real-time. How would you get the color scheme to align with family? There’s more than one good way to do this.</p>
</section>
<section id="text-labels-by-species" class="level2">
<h2 class="anchored" data-anchor-id="text-labels-by-species">Text Labels by Species</h2>
<p>A more clear way to handle this is to use <code>mark_text()</code> to explicitly label each dot. However, that comes at the cost of adding a lot of chart clutter.</p>
<div id="253c69da" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> alt.Chart(antibiotics).mark_circle(size<span class="op">=</span><span class="dv">80</span>).encode(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Penicillin:Q'</span>,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Penicillin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'Streptomycin:Q'</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'Streptomycin MIC (μg/ml, reverse log scale)'</span>),</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    alt.Color(<span class="st">'Bacteria:N'</span>, legend<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>).properties(width<span class="op">=</span><span class="dv">250</span>, height<span class="op">=</span><span class="dv">250</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add text labels next to each dot</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> base.mark_text(</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    align<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    baseline<span class="op">=</span><span class="st">'middle'</span>,</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    dx<span class="op">=</span><span class="dv">7</span>,  <span class="co"># Adjust the position of the text</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    dy<span class="op">=-</span><span class="dv">5</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>).encode(</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span><span class="st">'Bacteria:O'</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the base chart with the text labels</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> base <span class="op">+</span> text</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>chart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="20">

<style>
  #altair-viz-420b55c0709d40fdb5318d90eb12314c.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-420b55c0709d40fdb5318d90eb12314c.vega-embed details,
  #altair-viz-420b55c0709d40fdb5318d90eb12314c.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-420b55c0709d40fdb5318d90eb12314c"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-420b55c0709d40fdb5318d90eb12314c") {
      outputDiv = document.getElementById("altair-viz-420b55c0709d40fdb5318d90eb12314c");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "layer": [{"mark": {"type": "circle", "size": 80}, "encoding": {"color": {"field": "Bacteria", "legend": null, "type": "nominal"}, "x": {"axis": {"tickCount": 5}, "field": "Penicillin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Penicillin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}, "y": {"axis": {"tickCount": 5}, "field": "Streptomycin", "scale": {"domain": [0.001, 1000], "type": "log"}, "title": "Streptomycin MIC (\u03bcg/ml, reverse log scale)", "type": "quantitative"}}}, {"mark": {"type": "text", "align": "left", "baseline": "middle", "dx": 7, "dy": -5}, "encoding": {"color": {"field": "Bacteria", "legend": null, "type": "nominal"}, "text": {"field": "Bacteria", "type": "ordinal"}, "x": {"axis": {"tickCount": 5}, "field": "Penicillin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Penicillin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}, "y": {"axis": {"tickCount": 5}, "field": "Streptomycin", "scale": {"domain": [0.001, 1000], "type": "log"}, "title": "Streptomycin MIC (\u03bcg/ml, reverse log scale)", "type": "quantitative"}}}], "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "height": 250, "width": 250, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<p>Discussion question – What is another way we have seen to make it possible for the reader to see what each dot is labeled, but using less clutter?</p>
</section>
<section id="color-by-genus-i" class="level2">
<h2 class="anchored" data-anchor-id="color-by-genus-i">Color by Genus I</h2>
<p>Need to use <code>transform_calculate()</code> to extract <code>Genus</code></p>
<div id="990857fc" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_circle(size<span class="op">=</span><span class="dv">80</span>).transform_calculate(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    Genus<span class="op">=</span><span class="st">'split(datum.Bacteria, " ")[0]'</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>).encode(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Neomycin:Q'</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Neomycin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'Penicillin:Q'</span>,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Penicillin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    alt.Color(<span class="st">'Genus:N'</span>,</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(scheme<span class="op">=</span><span class="st">'tableau20'</span>))</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>).properties(width<span class="op">=</span><span class="dv">250</span>, height<span class="op">=</span><span class="dv">250</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="21">

<style>
  #altair-viz-eb5c7d1038d54d2fb42c1545a15f17f5.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-eb5c7d1038d54d2fb42c1545a15f17f5.vega-embed details,
  #altair-viz-eb5c7d1038d54d2fb42c1545a15f17f5.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-eb5c7d1038d54d2fb42c1545a15f17f5"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-eb5c7d1038d54d2fb42c1545a15f17f5") {
      outputDiv = document.getElementById("altair-viz-eb5c7d1038d54d2fb42c1545a15f17f5");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "circle", "size": 80}, "encoding": {"color": {"field": "Genus", "scale": {"scheme": "tableau20"}, "type": "nominal"}, "x": {"axis": {"tickCount": 5}, "field": "Neomycin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Neomycin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}, "y": {"axis": {"tickCount": 5}, "field": "Penicillin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Penicillin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}}, "height": 250, "transform": [{"calculate": "split(datum.Bacteria, \" \")[0]", "as": "Genus"}], "width": 250, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="color-by-genus-ii" class="level2">
<h2 class="anchored" data-anchor-id="color-by-genus-ii">Color by Genus II</h2>
<p>Recode infrequent <code>Genus</code> values to “Other”.</p>
<div id="2ab638f3" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_circle(size<span class="op">=</span><span class="dv">80</span>).transform_calculate(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  Split<span class="op">=</span><span class="st">'split(datum.Bacteria, " ")[0]'</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>).transform_calculate(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  Genus<span class="op">=</span><span class="st">'indexof(["Salmonella", "Staphylococcus", "Streptococcus"], datum.Split) &gt;= 0 ? datum.Split : "Other"'</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>).encode(</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Neomycin:Q'</span>,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Neomycin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'Penicillin:Q'</span>,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>          sort<span class="op">=</span><span class="st">'descending'</span>,</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, domain<span class="op">=</span>[<span class="fl">0.001</span>, <span class="dv">1000</span>]),</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>          axis<span class="op">=</span>alt.Axis(tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'← Less effective --- Penicillin MIC (μg/ml) --- more effective →'</span>),</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    alt.Color(<span class="st">'Genus:N'</span>,</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>          scale<span class="op">=</span>alt.Scale(</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>            domain<span class="op">=</span>[<span class="st">'Salmonella'</span>, <span class="st">'Staphylococcus'</span>, <span class="st">'Streptococcus'</span>, <span class="st">'Other'</span>],</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>            <span class="bu">range</span><span class="op">=</span>[<span class="st">'rgb(76,120,168)'</span>, <span class="st">'rgb(84,162,75)'</span>, <span class="st">'rgb(228,87,86)'</span>, <span class="st">'rgb(121,112,110)'</span>]</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>          ))</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>).properties(width<span class="op">=</span><span class="dv">250</span>, height<span class="op">=</span><span class="dv">250</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">

<style>
  #altair-viz-e3dc684a1fbc4278b92655c8acf45e56.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-e3dc684a1fbc4278b92655c8acf45e56.vega-embed details,
  #altair-viz-e3dc684a1fbc4278b92655c8acf45e56.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-e3dc684a1fbc4278b92655c8acf45e56"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-e3dc684a1fbc4278b92655c8acf45e56") {
      outputDiv = document.getElementById("altair-viz-e3dc684a1fbc4278b92655c8acf45e56");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "circle", "size": 80}, "encoding": {"color": {"field": "Genus", "scale": {"domain": ["Salmonella", "Staphylococcus", "Streptococcus", "Other"], "range": ["rgb(76,120,168)", "rgb(84,162,75)", "rgb(228,87,86)", "rgb(121,112,110)"]}, "type": "nominal"}, "x": {"axis": {"tickCount": 5}, "field": "Neomycin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Neomycin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}, "y": {"axis": {"tickCount": 5}, "field": "Penicillin", "scale": {"domain": [0.001, 1000], "type": "log"}, "sort": "descending", "title": "\u2190 Less effective --- Penicillin MIC (\u03bcg/ml) --- more effective \u2192", "type": "quantitative"}}, "height": 250, "transform": [{"calculate": "split(datum.Bacteria, \" \")[0]", "as": "Split"}, {"calculate": "indexof([\"Salmonella\", \"Staphylococcus\", \"Streptococcus\"], datum.Split) >= 0 ? datum.Split : \"Other\"", "as": "Genus"}], "width": 250, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<p>Remark: the <code>antibiotics</code> dataset actually already comes with a column called <code>Genus</code> but the textbook recreates it in the code block above in order to show you how to add categories as part of a single code block in vega.</p>
</section>
<section id="color-by-antibiotic-response-i" class="level2">
<h2 class="anchored" data-anchor-id="color-by-antibiotic-response-i">Color by Antibiotic Response I</h2>
<div id="7b64feb6" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics).mark_rect().encode(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'Bacteria:N'</span>,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>      sort<span class="op">=</span>alt.EncodingSortField(field<span class="op">=</span><span class="st">'Penicillin'</span>, op<span class="op">=</span><span class="st">'max'</span>, order<span class="op">=</span><span class="st">'descending'</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    alt.Color(<span class="st">'Penicillin:Q'</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="23">

<style>
  #altair-viz-b0a6db2a6fc244dd8609a061a2f0156c.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-b0a6db2a6fc244dd8609a061a2f0156c.vega-embed details,
  #altair-viz-b0a6db2a6fc244dd8609a061a2f0156c.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-b0a6db2a6fc244dd8609a061a2f0156c"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-b0a6db2a6fc244dd8609a061a2f0156c") {
      outputDiv = document.getElementById("altair-viz-b0a6db2a6fc244dd8609a061a2f0156c");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "rect"}, "encoding": {"color": {"field": "Penicillin", "type": "quantitative"}, "y": {"field": "Bacteria", "sort": {"field": "Penicillin", "op": "max", "order": "descending"}, "type": "nominal"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="color-by-antibiotic-response-ii" class="level2">
<h2 class="anchored" data-anchor-id="color-by-antibiotic-response-ii">Color by Antibiotic Response II</h2>
<p>Cosmetic improvements:</p>
<ul>
<li>add plot title</li>
<li>format <code>alt.Y(... alt.Axis())</code></li>
<li>format <code>alt.Color</code> with <code>plasma</code> color scheme, legend edits</li>
</ul>
<div id="3f31c0a2" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(antibiotics, title<span class="op">=</span><span class="st">'Penicillin Resistance of Bacterial Strains'</span>).mark_rect().encode(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'Bacteria:N'</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>      sort<span class="op">=</span>alt.EncodingSortField(field<span class="op">=</span><span class="st">'Penicillin'</span>, op<span class="op">=</span><span class="st">'max'</span>, order<span class="op">=</span><span class="st">'descending'</span>),</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>      axis<span class="op">=</span>alt.Axis(</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>        orient<span class="op">=</span><span class="st">'right'</span>,     <span class="co"># orient axis on right side of chart</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>        titleX<span class="op">=</span><span class="dv">7</span>,           <span class="co"># set x-position to 7 pixels right of chart</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>        titleY<span class="op">=-</span><span class="dv">2</span>,          <span class="co"># set y-position to 2 pixels above chart</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>        titleAlign<span class="op">=</span><span class="st">'left'</span>,  <span class="co"># use left-aligned text</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>        titleAngle<span class="op">=</span><span class="dv">0</span>        <span class="co"># undo default title rotation</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    alt.Color(<span class="st">'Penicillin:Q'</span>,</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>      scale<span class="op">=</span>alt.Scale(<span class="bu">type</span><span class="op">=</span><span class="st">'log'</span>, scheme<span class="op">=</span><span class="st">'plasma'</span>, nice<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>      legend<span class="op">=</span>alt.Legend(titleOrient<span class="op">=</span><span class="st">'right'</span>, tickCount<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>      title<span class="op">=</span><span class="st">'Penicillin MIC (μg/ml)'</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>).configure_title(</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  anchor<span class="op">=</span><span class="st">'start'</span>, <span class="co"># anchor and left-align title</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>  offset<span class="op">=</span><span class="dv">5</span>        <span class="co"># set title offset from chart</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.

/opt/anaconda3/lib/python3.11/site-packages/altair/utils/core.py:395: FutureWarning:

the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="24">

<style>
  #altair-viz-5407a08ce70a4b5b95ed6922b801ff54.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-5407a08ce70a4b5b95ed6922b801ff54.vega-embed details,
  #altair-viz-5407a08ce70a4b5b95ed6922b801ff54.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-5407a08ce70a4b5b95ed6922b801ff54"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-5407a08ce70a4b5b95ed6922b801ff54") {
      outputDiv = document.getElementById("altair-viz-5407a08ce70a4b5b95ed6922b801ff54");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}, "title": {"anchor": "start", "offset": 5}}, "data": {"name": "data-8833440f737304311e72aeeffd7b9881"}, "mark": {"type": "rect"}, "encoding": {"color": {"field": "Penicillin", "legend": {"tickCount": 5, "titleOrient": "right"}, "scale": {"nice": true, "scheme": "plasma", "type": "log"}, "title": "Penicillin MIC (\u03bcg/ml)", "type": "quantitative"}, "y": {"axis": {"orient": "right", "titleAlign": "left", "titleAngle": 0, "titleX": 7, "titleY": -2}, "field": "Bacteria", "sort": {"field": "Penicillin", "op": "max", "order": "descending"}, "type": "nominal"}}, "title": "Penicillin Resistance of Bacterial Strains", "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-8833440f737304311e72aeeffd7b9881": [{"Bacteria": "Aerobacter aerogenes", "Penicillin": 870.0, "Streptomycin": 1.0, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Brucella abortus", "Penicillin": 1.0, "Streptomycin": 2.0, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "other"}, {"Bacteria": "Escherichia coli", "Penicillin": 100.0, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850.0, "Streptomycin": 1.2, "Neomycin": 1.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800.0, "Streptomycin": 5.0, "Neomycin": 2.0, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Proteus vulgaris", "Penicillin": 3.0, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850.0, "Streptomycin": 2.0, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"}, {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1.0, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10.0, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"}, {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"}, {"Bacteria": "Streptococcus fecalis", "Penicillin": 1.0, "Streptomycin": 1.0, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14.0, "Neomycin": 10.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}, {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10.0, "Neomycin": 40.0, "Gram_Staining": "positive", "Genus": "Streptococcus"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="configuring-color-legends-summary" class="level2">
<h2 class="anchored" data-anchor-id="configuring-color-legends-summary">Configuring Color Legends: summary</h2>
<ul>
<li>Overarching idea: visualization as a tool for discovery</li>
<li>Avoid
<ul>
<li>Too many groups in a legend</li>
<li>Colors that are too similar for groups that are actually dissimilar (e.g.&nbsp;when the underlying variable is <code>N</code>ominal)<br>
</li>
</ul></li>
<li>Strive to
<ul>
<li>Choose colors with external meaning (e.g.&nbsp;gram staining)</li>
<li>Construct categorical variables (e.g.&nbsp;<code>Genus</code>)</li>
<li>If you must have many categories, put annotation directly next to dots or create an interactive plot with a tooltip.</li>
<li>Choose colors that are easy to discern (e.g.&nbsp;<code>viridis</code>, <code>plasma</code>)</li>
</ul></li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>